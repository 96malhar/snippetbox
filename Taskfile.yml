version: '3'

dotenv: [ '.env' ]

tasks:
  start-postgres:
    desc: Start a Postgres server via docker compose
    cmds:
      - docker compose up -d

  stop-postgres:
    desc: Stops Postgres server via docker compose
    cmds:
      - docker compose down

  migrate-up:
    desc: Sets up the database to run Snippetbox as a web app
    cmds:
      - go run ./cmd/migration up

  migrate-down:
    desc: Deletes the database used by Snippetbox
    cmds:
      - go run ./cmd/migration down

  generate-tls-cert:
    dir: ./tls
    desc: Generates TLS certificate to run Snippetbox on HTTPS
    cmds:
      - go run {{.GOROOT}}/src/crypto/tls/generate_cert.go --rsa-bits=2048 --host=localhost

  run:
    desc: Runs Snippetbox as a web application
    cmds:
      - go run ./cmd/web

  test:
    desc: Runs all tests
    cmds:
      - go test ./... {{.CLI_ARGS}}
